{% extends 'tasky/base.html' %} 

{% block content %}

<div
  class="px-6 py-6 bg-blue-500 bg-gradient-60deg bg-gradient-to-br from-violet-200 via-blue-200 to-blue-700 min-h-screen "
>
  <div
    class="bg-white min-h-[600px]  min-h-80% rounded-md shadow-md grid grid-cols-12 "
  >
  <div class="col-span-2 bg-gray-50 max-h-full rounded-md w-full grid grid-rows-12 gap-8 hidden lg:grid">
    <div class="row-span-4 flex flex-cols items-center justify-center">
      <div class="self-start ml-4 w-full py-5">
        <h2 class="mb-5 font-semibold text-violet-700 text-2xl flex space-x-2">
          <i class="fas fa-layer-group mt-2"></i><span> Tasky </span>
        </h2>
        <ul class="mt-10 space-y-4 w-full">
          <li>
            <a href="#" class="text-center block bg-blue-700 text-white w-full py-2 rounded-tl-md rounded-bl-md font-semibold flex justify-start items-center space-x-2">
              <i class="fas fa-tachometer-alt text-2xl"></i><span>Dashboard</span>
            </a>
          </li>
          <li>
            <a href="#" class="text-center block hover:bg-blue-700 hover:text-white w-full py-2 rounded-tl-md rounded-bl-md font-semibold ml-0 px-0 flex justify-start items-center space-x-2">
              <i class="fas fa-tasks text-2xl"></i><span>Tasks</span>
            </a>
          </li>
          <li>
            <a href="#" class="text-center block hover:bg-blue-700 hover:text-white w-full py-2 rounded-tl-md rounded-bl-md font-semibold ml-0 px-0 flex justify-start items-center space-x-2">
              <i class="far fa-calendar text-2xl"></i><span>Calendar</span>
            </a>
          </li>
          <li>
            <a href="#" class="text-center block hover:bg-blue-700 hover:text-white w-full py-2 rounded-tl-md rounded-bl-md font-semibold ml-0 px-0 flex justify-start items-center space-x-2">
              <i class="fas fa-users text-2xl"></i><span>Members</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  
    <div class="row-span-8 flex flex-rows p-6 justify-end items-end">
      <div class="relative w-full h-full">
        <div class="hover:bg-blue-300 hover:cursor-pointer absolute bottom-0 left-0 p-4 text-sm bg-gradient-to-t from-blue-600 to-fuchsia-300 border-t-0 border-r-0 outline-none rounded-md">
          <i class="fas fa-rocket absolute top-0 right-0 text-5xl mb-5 text-blue-700 font-semibold"></i>
          <p class="text-white mt-7">Upgrade to Pro !</p>
        </div>
      </div>
    </div>
  </div>
  







    <div class="col-span-10 min-h-full w-full grid grid-rows-12 py-2">

  <!----- Search Form -->
      <div
        class="row-span-1 w-full space-y-2 flex flex-wrap item-start justify-start md:items-start md:justify-start max-h-[50px]"
      >



      <div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl">
        <div class="p-8">
          <h1 class="font-bold text-xl">Search Tasks here </h1> 
            <form id="search-form" >
                {{ form.as_p }}
                <button type="submit" class="mt-4 relative bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-8 rounded">
                  <i
                  class="fas fa-search absolute left-1 top-1/2 transform -translate-y-1/2 text-white font-bold text-2xl pr-4"
                ></i><span> Search Tasks</span>
                </button>
            </form>
        </div>
    </div>
  

    <!---- Modal -->
    
    <!-- Modal -->
    <div id="results-modal" class="fixed z-10 inset-0 overflow-y-auto hidden">
      <div class="flex items-center justify-center min-h-screen">
          <div class="bg-gray-300 rounded-lg shadow-xl max-w-lg w-full p-6">
              <h3 class="text-lg leading-6 font-medium text-gray-900">Search Results</h3>
              <div class="mt-2" id="results-content">
                  <!-- Search results will be injected here -->
              </div>
              <div class="mt-4">
                  <button type="button" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" onclick="closeModal()">
                      Close
                  </button>
              </div>
          </div>
      </div>
  </div>



      </div>

      
   



      <!----- End of Search Form  -->




      

















      <div class="row-span-1 flex flex-col md:flex-row items-center justify-between flex-wrap max-h-[50px] space-y-2 md:space-y-0">
        <div class="flex flex-wrap justify-center md:justify-start space-x-2">
          <a class="rounded-md px-4 py-2 shadow-md border m-2" href="" rel="noopener noreferrer">Preview</a>
          <a class="rounded-md px-4 py-2 shadow-md border m-2" href="" rel="noopener noreferrer">Sort</a>
          <a class="rounded-md px-4 py-2 shadow-md border m-2" href="" rel="noopener noreferrer">Filter</a>
        </div>
        <div class="flex flex-wrap justify-center md:justify-end space-x-2 px-4">
          <button class="px-4 py-2"><i class="fas fa-users text-2xl"></i></button>
          <button class="broken-button outline-dash-array bg-white hover:bg-gray-100 rounded-full px-4 outline-none py-2 font-bold border mt-2 w-10 h-10 outline-dash-array border-dashed">+</button>
          <a href="{% url 'tasky:task-create' %}" class="bg-blue-800 text-white rounded-md m-2 px-4 py-2 hover:bg-blue-400">+ Add task</a>
        </div>
      </div>
      







      <!--- The last row of the main content -->
      <div class="flex flex-cols-3 flex-wrap justify-between px-2 gap-4">

        <div class="w-full md:w-1/4 mb-4 md:mb-0  min-h-full md:min-h-full">
          <div class="row-span-1">  
            <button class="text-left font-semibold border border-violet-500 w-full rounded-md shadow-md py-2 px-4">
              In Progress <span>({{in_progress_tasks.count}})</span>
            </button>
          </div>
          <div class="others">

            {% for task_progress in in_progress_tasks %}
<!--- Start of dynamic loading -->
<div class="max-w-sm rounded overflow-hidden shadow-lg bg-white mb-4 mt-4">
  <!-- Card Header -->
  <div class="flex space-x-2 text-sm font-medium py-2 px-4 bg-gray-100 justify-center items-center">
    <span class="py-1 px-2 rounded-md {% if task_progress.priority == 'high' %}
    bg-red-100 text-red-700
  {% elif task_progress.priority == 'medium' %}
    bg-yellow-100 text-yellow-700
  {% else %}
    bg-green-100 text-green-700
  {% endif %}">{{ task_progress.priority }}</span>
    <span class="py-1 px-2 rounded-md bg-blue-100 text-blue-700"><i class="fas fa-clock"></i> {{ task_progress.due_date }}</span>
    <span class="py-1 px-2 rounded-md bg-green-100 text-green-700">{{ task_progress.category }}</span>
  </div>

  <!-- Card Body -->
  <div class="px-4 py-4">
    <div class="font-bold text-lg mb-2 flex justify-between items-center">
      <h1 class="text-lg">{{ task_progress.title }}</h1>
      <i class="fas fa-ellipsis-v"></i>
    </div>
    <p class="text-gray-700 text-sm">
      {{ task_progress.description|truncatewords:20 }}
      <br/>
      <span class="text-xs text-gray-500"><i class="fas fa-list-ol"></i> {{ task_progress.id }}/{{ in_progress_tasks.count }}</span>
    </p>
  </div>

  <!-- Card Footer -->
  <div class="px-4 py-2 bg-gray-100 flex justify-between items-center">
    <a href="{% url 'tasky:task-detail' task_progress.pk %}" class="text-blue-500 hover:text-blue-700">
      <i class="fas fa-eye"></i>
    </a>
    <a href="{% url 'tasky:task-delete' task_progress.pk %}" class="text-red-500 hover:text-red-700">
      <i class="fas fa-trash"></i>
    </a>
    <a href="{% url 'tasky:task-update' task_progress.pk %}" class="text-green-500 hover:text-green-700">
      <i class="fas fa-pencil-alt"></i>
    </a>
  </div>
</div>
<!---- End of Dynamic loading -->
{% endfor %}

            
              

          </div>



        </div>
      
        <div class=" w-full md:w-1/4 mb-4 md:mb-0  ">
          <div class="row-span-1">
            <button class="text-left font-semibold border border-violet-500 w-full rounded-md shadow-md py-2 px-4">
              Completed Task <span>({{ completed_tasks.count}})</span>
            </button>
          </div>

        <div class="others">
          {% for task_completed in completed_tasks %}
<!--- Start of dynamic loading -->
<div class="max-w-sm rounded overflow-hidden shadow-lg bg-white mb-4 mt-4">
  <!-- Card Header -->
  <div class="flex space-x-2 text-sm font-medium py-2 px-4 bg-gray-100 justify-center items-center">
    <span class="py-1 px-2 rounded-md {% if task_completed.priority == 'high' %}
    bg-red-100 text-red-700
  {% elif task_completed.priority == 'medium' %}
    bg-yellow-100 text-yellow-700
  {% else %}
    bg-green-100 text-green-700
  {% endif %}">{{ task_completed.priority }}</span>
    <span class="py-1 px-2 rounded-md bg-blue-100 text-blue-700"><i class="fas fa-clock"></i> {{ task_completed.due_date }}</span>
    <span class="py-1 px-2 rounded-md bg-green-100 text-green-700">{{ task_completed.category }}</span>
  </div>

  <!-- Card Body -->
  <div class="px-4 py-4">
    <div class="font-bold text-lg mb-2 flex justify-between items-center">
      <h1 class="text-lg">{{ task_completed.title }}</h1>
      <i class="fas fa-ellipsis-v"></i>
    </div>
    <p class="text-gray-700 text-sm">
      {{ task_completed.description|truncatewords:20 }}
      <br/>
      <span class="text-xs text-gray-500"><i class="fas fa-list-ol"></i> {{ task_completed.id }}/{{ in_progress_tasks.count }}</span>
    </p>
  </div>

  <!-- Card Footer -->
  <div class="px-4 py-2 bg-gray-100 flex justify-between items-center">
    <a href="{% url 'tasky:task-detail' task_completed.pk %}" class="text-blue-500 hover:text-blue-700">
      <i class="fas fa-eye"></i>
    </a>
    <a href="{% url 'tasky:task-delete' task_completed.pk %}" class="text-red-500 hover:text-red-700">
      <i class="fas fa-trash"></i>
    </a>
    <a href="{% url 'tasky:task-update' task_completed.pk %}" class="text-green-500 hover:text-green-700">
      <i class="fas fa-pencil-alt"></i>
    </a>
  </div>
</div>
<!---- End of Dynamic loading -->
{% endfor %}
        </div>


        </div>
      
        <div class=" w-full md:w-1/4 ">
          <div class="row-span-1">
            <button class="text-left font-semibold border border-violet-500 w-full rounded-md shadow-md py-2 px-4">
              Over-Due <span>({{ overdue_tasks.count }})</span>
            </button>

          </div>

         <div class="others">
          {% for task_overdue in overdue_tasks %}
<!--- Start of dynamic loading -->
<div class="max-w-sm rounded overflow-hidden shadow-lg bg-white mb-4 mt-4">
  <!-- Card Header -->
  <div class="flex space-x-2 text-sm font-medium py-2 px-4 bg-gray-100 justify-center items-center">
    <span class="py-1 px-2 rounded-md {% if task_overdue.priority == 'high' %}
    bg-red-100 text-red-700
  {% elif task_overdue.priority == 'medium' %}
    bg-yellow-100 text-yellow-700
  {% else %}
    bg-green-100 text-green-700
  {% endif %}">{{ task_overdue.priority }}</span>
    <span class="py-1 px-2 rounded-md bg-blue-100 text-blue-700"><i class="fas fa-clock"></i> {{ task_overdue.due_date }}</span>
    <span class="py-1 px-2 rounded-md bg-green-100 text-green-700">{{ task_overdue.category }}</span>
  </div>

  <!-- Card Body -->
  <div class="px-4 py-4">
    <div class="font-bold text-lg mb-2 flex justify-between items-center">
      <h1 class="text-lg">{{ task_overdue.title }}</h1>
      <i class="fas fa-ellipsis-v"></i>
    </div>
    <p class="text-gray-700 text-sm">
      {{ task_overdue.description|truncatewords:20 }}
      <br/>
      <span class="text-xs text-gray-500"><i class="fas fa-list-ol"></i> {{ task_overdue.id }}/{{ in_progress_tasks.count }}</span>
    </p>
  </div>

  <!-- Card Footer -->
  <div class="px-4 py-2 bg-gray-100 flex justify-between items-center">
    <a href="{% url 'tasky:task-detail' task_overdue.pk %}" class="text-blue-500 hover:text-blue-700">
      <i class="fas fa-eye"></i>
    </a>
    <a href="{% url 'tasky:task-delete' task_overdue.pk %}" class="text-red-500 hover:text-red-700">
      <i class="fas fa-trash"></i>
    </a>
    <a href="{% url 'tasky:task-update' task_overdue.pk %}" class="text-green-500 hover:text-green-700">
      <i class="fas fa-pencil-alt"></i>
    </a>
  </div>
</div>
<!---- End of Dynamic loading -->
{% endfor %}
         </div>
          


          






         <div>

           


        











      </div>
      
      


       
       


     
     






        
      
    </div>
  </div>
</div>

{% endblock %}


{% block javascript %}


<!----- Javascript code for the Search Tasks -->
<script>
  document.getElementById('search-form').addEventListener('submit', function(event) {
      event.preventDefault();
      const query = document.querySelector('input[name="query"]').value;
      const sortBy = document.querySelector('select[name="sort_by"]').value;
      const status = document.querySelector('select[name="status"]').value;
      const priority = document.querySelector('select[name="priority"]').value;

      fetch(`/dashboard/?query=${query}&sort_by=${sortBy}&status=${status}&priority=${priority}`, {
          headers: {
              'X-Requested-With': 'XMLHttpRequest'
          }
      })
      .then(response => response.json())
      .then(data => {
          const resultsContent = document.getElementById('results-content');
          resultsContent.innerHTML = '';
          data.results.forEach(result => {
              resultsContent.innerHTML += `<div class="p-2 border-b">
                  <h4 class="font-bold">${result.title}</h4>
                  <p>${result.description}</p>
                  <p>Due Date: ${result.due_date}</p>
                  <p>Priority: ${result.priority}</p>
                  <p>Status: ${result.status}</p>
                  <p>Category: ${result.category}</p>
                  <p>Assigned to: ${result.assigned_to}</p>
                  <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-2 rounded mt-2">Preview</button>
              </div>`;
          });
          document.getElementById('results-modal').classList.remove('hidden');
      });
  });

  function closeModal() {
      document.getElementById('results-modal').classList.add('hidden');
  }
</script>

{% endblock %}