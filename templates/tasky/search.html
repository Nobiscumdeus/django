{% extends 'tasky/base.html' %}

{% block content %}
    <div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl">
        <div class="p-8">
            <h2 class="text-2xl font-bold mb-4">Search Tasks</h2>
            <form id="search-form">
                {{ form.as_p }}
                <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    Search
                </button>
            </form>
        </div>
    </div>

    <!-- Modal -->
    <div id="results-modal" class="fixed z-10 inset-0 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white rounded-lg shadow-xl max-w-lg w-full p-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Search Results</h3>
                <div class="mt-2" id="results-content">
                    <!-- Search results will be injected here -->
                </div>
                <div class="mt-4">
                    <button type="button" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" onclick="closeModal()">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    {% block javascript %}
    <script>
        document.getElementById('search-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const query = document.querySelector('input[name="query"]').value;
            const sortBy = document.querySelector('select[name="sort_by"]').value;
            const status = document.querySelector('select[name="status"]').value;
            const priority = document.querySelector('select[name="priority"]').value;

            fetch(`/search/?query=${query}&sort_by=${sortBy}&status=${status}&priority=${priority}`, {
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                const resultsContent = document.getElementById('results-content');
                resultsContent.innerHTML = '';
                data.results.forEach(result => {
                    resultsContent.innerHTML += `<div class="p-2 border-b">
                        <h4 class="font-bold">${result.title}</h4>
                        <p>${result.description}</p>
                        <p>Due Date: ${result.due_date}</p>
                        <p>Priority: ${result.priority}</p>
                        <p>Status: ${result.status}</p>
                        <p>Category: ${result.category}</p>
                        <p>Assigned to: ${result.assigned_to}</p>
                        <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-2 rounded mt-2">Preview</button>
                    </div>`;
                });
                document.getElementById('results-modal').classList.remove('hidden');
            });
        });

        function closeModal() {
            document.getElementById('results-modal').classList.add('hidden');
        }
    </script>


    {% endblock %}